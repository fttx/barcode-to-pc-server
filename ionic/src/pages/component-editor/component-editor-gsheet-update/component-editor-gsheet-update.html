<component-editor [outputBlock]="outputBlock" [validated]="isValid()">
  <div [hidden]="outputBlock.type != 'google_sheets'">

    <ion-item text-wrap no-lines>
      <label for="_googleSheetsUrl">{{ 'googleSheetsUrl' | translate }}</label>
      <input id="_googleSheetsUrl" [(ngModel)]="outputBlock.googleSheetsUrl" (ngModelChange)="onUrlChange()" (paste)="onUrlPaste()" class="inline-input" type="url" placeholder="Example: https://docs.google.com/spreadsheets/d/4281a3386e77d42a9089da5769fb7b22" [style.border]="isUrlInvalid() ? '1px solid #f53d3d' : (permissionsCheckResult === 'success' ? '1px solid #32db64' : '')" />
    </ion-item>

    <!-- Buttons row for Check Permissions and Tutorial -->
    <ion-item text-wrap style="position: relative; top: -10px;">
      <div style="display: flex; gap: 10px; ">
        <button ion-button small icon-start [disabled]="!outputBlock.googleSheetsUrl || outputBlock.googleSheetsUrl.trim() === '' || checkingPermissions" (click)="checkPermissions()" [color]="permissionsCheckResult === 'success' ? 'secondary' : (permissionsCheckResult === 'denied' || permissionsCheckResult === 'error' ? 'danger' : 'primary')">
          <ion-icon name="checkmark-circle" *ngIf="permissionsCheckResult === 'success'"></ion-icon>
          <ion-icon name="close-circle" *ngIf="permissionsCheckResult === 'denied' || permissionsCheckResult === 'error'"></ion-icon>
          <ion-icon name="sync" *ngIf="!permissionsCheckResult && !checkingPermissions"></ion-icon>
          <ion-spinner name="crescent" *ngIf="checkingPermissions" style="width: 18px; height: 18px;"></ion-spinner>
          <span *ngIf="!checkingPermissions && !permissionsCheckResult">{{ 'googleSheetsRefresh' | translate }}</span>
          <span *ngIf="checkingPermissions">{{ 'googleSheetsCheckingPermissions' | translate }}</span>
          <span *ngIf="permissionsCheckResult === 'success'">{{ 'googleSheetsPermissionsGranted' | translate }}</span>
          <span *ngIf="permissionsCheckResult === 'denied'">{{ 'googleSheetsPermissionsDenied' | translate }}</span>
          <span *ngIf="permissionsCheckResult === 'error'">{{ 'googleSheetsPermissionsError' | translate }}</span>
        </button>
        <button ion-button small icon-start color="light" (click)="openTutorial()">
          <ion-icon name="help-circle"></ion-icon>
          {{ 'googleSheetsTutorial' | translate }}
        </button>
      </div>
    </ion-item>

    <ion-item text-wrap>
      <label for="_googleSheetsAction">{{ 'googleSheetsAction' | translate }}</label>
      <select id="_googleSheetsAction" [(ngModel)]="outputBlock.googleSheetsAction" (ngModelChange)="markFormAsTouched()" class="component-editor-select">
        <option value="append_or_update">{{ 'googleSheetsActionAppend' | translate }}</option>
        <option value="get">{{ 'googleSheetsActionGet' | translate }}</option>
        <option value="get_cell">{{ 'googleSheetsActionGetCell' | translate }}</option>
        <option value="delete">{{ 'googleSheetsActionDelete' | translate }}</option>
      </select>
      <br>
      <p>
        {{ 'googleSheetsActionDescription' | translate }}
      </p>
    </ion-item>

    <ion-item text-wrap>
      <label for="_keyColumn">{{ 'googleSheetsKeyColumn' | translate }}</label>
      <div style="display: flex; gap: 10px; align-items: stretch; width: 100%; align-items: center;">
        <div style="position: relative; width: 100%; flex: 1;">
          <ion-icon name="key" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #999; z-index: 1;"></ion-icon>
          <select id="_keyColumn" [(ngModel)]="outputBlock.googleSheetKeyColumn" (ngModelChange)="markFormAsTouched()" class="component-editor-select" style="padding-left: 35px; width: 100%;">
            <option *ngFor="let col of availableColumns" [value]="col">{{ col }}</option>
          </select>
        </div>
        <button ion-button small icon-only [disabled]="!outputBlock.googleSheetsUrl || outputBlock.googleSheetsUrl.trim() === '' || checkingPermissions" (click)="checkPermissions()" [color]="permissionsCheckResult === 'success' ? 'secondary' : (permissionsCheckResult === 'denied' || permissionsCheckResult === 'error' ? 'danger' : 'primary')" style="width: 40px; min-width: 40px; height: 36px; margin: 0;">
          <ion-icon name="checkmark-circle" *ngIf="permissionsCheckResult === 'success'"></ion-icon>
          <ion-icon name="close-circle" *ngIf="permissionsCheckResult === 'denied' || permissionsCheckResult === 'error'"></ion-icon>
          <ion-icon name="sync" *ngIf="!permissionsCheckResult && !checkingPermissions"></ion-icon>
          <ion-spinner name="crescent" *ngIf="checkingPermissions" style="width: 18px; height: 18px;"></ion-spinner>
        </button>
      </div>
      <p>
        {{ 'googleSheetsKeyColumnDescription' | translate }}
      </p>
    </ion-item>

    <!-- Column selector for Get Cell action -->
    <ion-item text-wrap no-lines *ngIf="outputBlock.googleSheetsAction === 'get_cell'">
      <label for="_cellColumn">{{ 'googleSheetsGetCellColumn' | translate }}</label>
      <div style="display: flex; gap: 10px; align-items: stretch; width: 100%;     align-items: center;">
        <select id="_cellColumn" [(ngModel)]="outputBlock.googleSheetsCellColumn" (ngModelChange)="markFormAsTouched()" class="component-editor-select" [style.border]="validationAttempted && (!outputBlock.googleSheetsCellColumn || outputBlock.googleSheetsCellColumn.trim() === '') ? '1px solid #f53d3d' : ''" style="flex: 1;">
          <option *ngFor="let col of availableColumns" [value]="col">{{ col }}</option>
        </select>
        <button ion-button small icon-only [disabled]="!outputBlock.googleSheetsUrl || outputBlock.googleSheetsUrl.trim() === '' || checkingPermissions" (click)="checkPermissions()" [color]="permissionsCheckResult === 'success' ? 'secondary' : (permissionsCheckResult === 'denied' || permissionsCheckResult === 'error' ? 'danger' : 'primary')" style="width: 40px; min-width: 40px; height: 36px; margin: 0;">
          <ion-icon name="checkmark-circle" *ngIf="permissionsCheckResult === 'success'"></ion-icon>
          <ion-icon name="close-circle" *ngIf="permissionsCheckResult === 'denied' || permissionsCheckResult === 'error'"></ion-icon>
          <ion-icon name="sync" *ngIf="!permissionsCheckResult && !checkingPermissions"></ion-icon>
          <ion-spinner name="crescent" *ngIf="checkingPermissions" style="width: 18px; height: 18px;"></ion-spinner>
        </button>
      </div>
      <p>
        {{ 'googleSheetsGetCellDescription' | translate }}
      </p>
    </ion-item>

    <!-- Columns Section for Append or Update Action -->
    <div *ngIf="outputBlock.googleSheetsAction === 'append_or_update'">

      <ion-item text-wrap no-lines>
        <ion-label>
          <h2>{{ 'googleSheetsColumns' | translate }}</h2>
        </ion-label>
      </ion-item>
      <div class="component-editor-card ">
        <ion-item text-wrap no-lines style="background: transparent;">
          <p>
            {{ 'googleSheetsColumnsDescription' | translate }}
          </p>
        </ion-item>

        <!-- Column Values List -->
        <ion-grid class="values-grid">
          <ion-item no-lines *ngFor="let value of outputBlock.googleSheetsValues; let i = index" style="background: transparent; padding-left: 11px;">
            <ion-row no-padding>
              <ion-col col-5>
                <div style="position: relative; width: 100%;">
                  <ion-icon *ngIf="outputBlock.googleSheetsValues[i].column === outputBlock.googleSheetKeyColumn" name="key" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #999; z-index: 1;"></ion-icon>
                  <select [(ngModel)]="outputBlock.googleSheetsValues[i].column" (ngModelChange)="markFormAsTouched()" class="component-editor-select" [style.border]="isColumnNameInvalid(i) ? '1px solid #f53d3d' : ''" [style.padding-left]="outputBlock.googleSheetsValues[i].column === outputBlock.googleSheetKeyColumn ? '35px' : ''" style="margin: 0;">
                    <option *ngFor="let col of availableColumns" [value]="col">{{ col }}</option>
                  </select>
                </div>
              </ion-col>
              <ion-col col-6>
                <input [(ngModel)]="outputBlock.googleSheetsValues[i].value" (ngModelChange)="markFormAsTouched()" class="inline-input" type="text" placeholder="Example: {{ curlyOpen }} number {{ curlyClose }}" variableInjector [style.border]="isColumnValueInvalid(i) ? '1px solid #f53d3d' : ''" />
              </ion-col>
              <ion-col col-1>
                <button ion-button small center clear icon-only color="danger" (click)="removeValue(i)" [disabled]="i === 0">
                  <ion-icon name="trash"></ion-icon>
                </button>
              </ion-col>
            </ion-row>
          </ion-item>
        </ion-grid>

        <ion-item no-lines>
          <div style="padding: 0; margin: 0">
            <button ion-button small icon-start (click)="addValue()">
              <ion-icon name="add"></ion-icon>
              {{ 'googleSheetsAddColumn' | translate }}
            </button>
          </div>
        </ion-item>
      </div>

      <ion-item></ion-item>

      <!-- Info for Get/Delete Actions -->
      <ion-item text-wrap *ngIf="outputBlock.googleSheetsAction === 'get'">
        <p>
          {{ 'googleSheetsGetRowDescription' | translate }}
        </p>
      </ion-item>
      <ion-item text-wrap *ngIf="outputBlock.googleSheetsAction === 'delete'">
        <p>
          {{ 'googleSheetsDeleteRowDescription' | translate }}
        </p>
      </ion-item>

    </div>

  </div>
</component-editor>
